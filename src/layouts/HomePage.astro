---
import type { CollectionEntry } from 'astro:content';
import BaseHead from '../components/BaseHead.astro';
import Footer from '../components/Footer.astro';
import FormattedDate from '../components/FormattedDate.astro';
import Header from '../components/Header.astro';
import { SITE_TITLE } from '../consts';
import { type Locale, blogIdToSlugAnyLocale, localePath } from '../i18n/config';
import { getMessages } from '../i18n/messages';

interface Props {
	locale: Locale;
	latestPosts: CollectionEntry<'blog'>[];
}

const { locale, latestPosts } = Astro.props;
const messages = getMessages(locale);
---

<!doctype html>
<html lang={locale}>
	<head>
		<BaseHead title={SITE_TITLE} description={messages.siteDescription} />
		<link rel="stylesheet" href="/styles/home-page.css" />
		<link rel="preload" href="/fonts/ff2a407fe06752facf8828a86955e988.woff2" as="font" type="font/woff2" crossorigin />
	</head>
	<body class="page-home">
		<canvas id="matrix-bg" aria-hidden="true"></canvas>
		<Header
			locale={locale}
			labels={{
				home: messages.nav.home,
				blog: messages.nav.blog,
				about: messages.nav.about,
				status: messages.nav.status,
				language: messages.langLabel,
			}}
		/>
		<main>
			<h1>{SITE_TITLE}</h1>
			<p class="home-hero-copy">
				{messages.home.hero}
			</p>

			<section class="home-latest">
				<h2 class="home-section-title">{messages.home.latest}</h2>
				<ul class="home-post-list">
					{
						latestPosts.length > 0 ? (
							latestPosts.map((post) => (
								<li>
									<a class="home-post-title" href={localePath(locale, `/blog/${blogIdToSlugAnyLocale(post.id)}`)}>
										{post.data.title}
									</a>
									<div class="home-post-meta">
										<FormattedDate date={post.data.pubDate} />
										{post.data.description && <> Â· {post.data.description}</>}
									</div>
								</li>
							))
						) : (
							<li>{messages.home.noPosts}</li>
						)
					}
				</ul>
				<p><a href={localePath(locale, '/blog/')}>{messages.home.viewAll}</a></p>
			</section>
		</main>
		<Footer tagline={messages.footer.tagline} />
			<script is:inline src="/scripts/home-matrix.js" defer></script>
		</body>
	</html>
