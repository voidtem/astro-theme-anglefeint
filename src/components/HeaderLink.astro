---
import type { HTMLAttributes } from 'astro/types';

type Props = HTMLAttributes<'a'>;

const { href, class: className, ...props } = Astro.props;
const basePath = import.meta.env.BASE_URL;
const stripBasePath = (value: string) => {
	if (!basePath || basePath === '/') return value;
	const normalizedBase = basePath.endsWith('/') ? basePath.slice(0, -1) : basePath;
	if (value === normalizedBase) return '/';
	if (value.startsWith(`${normalizedBase}/`)) return value.slice(normalizedBase.length);
	return value;
};
const normalize = (value: string) => {
	const withSlash = value.startsWith('/') ? value : `/${value}`;
	return withSlash.replace(/\/+$/, '') || '/';
};
const pathname = normalize(stripBasePath(Astro.url.pathname));
const target = normalize(String(href ?? '/'));
const targetDepth = target.split('/').filter(Boolean).length;
const isSectionLink = targetDepth >= 2;
const isActive =
	target === '/' ? pathname === '/' : pathname === target || (isSectionLink && pathname.startsWith(`${target}/`));
---

<a href={href} class:list={[className, { active: isActive }]} {...props}>
	<slot />
</a>
<style>
	a {
		display: inline-block;
		text-decoration: none;
	}
</style>
